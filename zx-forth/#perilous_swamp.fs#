( SCREEN 1 )

DECIMAL
: ARRAY1 <BUILDS ALLOT DOES> + ; ( IDX -- )
: ARRAY2 <BUILDS OVER OVER C, C, * ALLOT
  DOES> DUP C@ ROT * + + 2 + ;  ( COL ROW -- )
: 2DUP OVER OVER ;

( SCREEN 2 )

0 0 11 11 SCREEN SCRMAP
12 0 32 11 SCREEN SCRINS
0 12 32 20 SCREEN SCRMSG

5 ARRAY1 MAPLUT ( 0 - CLEAR ; 1 - WALL ; 2 - SWAMP ; 5 - PLAYER ; 4 - PRINCESS )
32 0 MAPLUT C@ 35 1 MAPLUT C@ 35 2 MAPLUT C@
80 4 MAPLUT C@ 88 5 MAPLUT C@ 
11 11 ARRAY2 MAP


: INITMAP
    11 0 DO ( FILL IN BORDER )
	1 I 0 MAP C!
	1 I 10 MAP C!
	1 0 I MAP C!
	1 10 I MAP C!
    LOOP 
    10 1 DO ( FILL IN CENTRE )
	10 1 DO
	    J I MAP
	    10 RND 6 < IF
		2
	    ELSE
		0
	    THEN
	    SWAP C!
	LOOP
    LOOP
;

( SCREEN 3 )

: PRINTMAP
    11 0 DO
	11 0 DO
	    I J MAP C@
	    MAPLUT C@
	    SCRMAP .C
	LOOP
	13 SCRMAP .C 10 SCRMAP .C
    LOOP
;

: INITPLAYER ( -- COL ROW )
   10 RND 1 + 1 2DUP MAP 5 SWAP C!
;

: IINITPRINCESS
    BEGIN
	3 RND 4 + 3 RND 4 + 2DUP MAP 5 =
    WHILE
	    DROP DROP
    REPEAT
    MAP 4 SWAP C!
;

: PRNTLN ( SCR -- )
    DUP .W 13 OVER .W 10 SWAP .W ;

: NOENTRY "TOO WET THAT WAY, CLOT" SCC .W SCC SCCR ;

: MV 3 PICK + SWAP 4 PICK + SWAP
    2DUP MAP C@ DUP 1 = IF
	DROP ROT DROP ROT DROP -1
    ELSE DUP 2 = IF
	    DROP DROP DROP 0
	ELSE
	    DROP ROT DROP ROT DROP 1
	THEN
    THEN
;

: RMPLAYER 2DUP MAP 0 SWAP C! ;

: INPLAYER 2DUP MAP 5 SWAP C! ;

: MVPLAYER DLPLAYER MV
    0 = IF NOENTRY
    THEN INPLAYER ;

: S 0 1 MVPLAYER ;
: N 0 -1 MVPLAYER ;